(self.webpackChunksale_counter=self.webpackChunksale_counter||[]).push([[406],{5555:function(e,t,n){"use strict";n.d(t,{$:function(){return l}});var r=n(4096),o=n(7294),l=o.memo((function(e){var t=e.children,n=e.justifyContent,l=e.h;return o.createElement(r.k,{alignItems:"center",minH:"60px",px:4,justifyContent:n,boxShadow:"0 -3px 3px rgba(0,0,0,0.1)",h:l},t)}))},8725:function(e,t,n){"use strict";n.d(t,{h:function(){return c}});var r=n(8017),o=n(4096),l=n(7294),i=n(6237),a=n(8193),u=n(980),c=l.memo((function(e){var t=e.children,n=e.rightNode,c=e.canGoBack,f=e.onRightNodeClick,m=(0,i.useHistory)(),d=(0,u.useColorModeValue)("white","gray.700");return l.createElement(r.xu,{position:"sticky",top:0,bgColor:d,shadow:"md"},l.createElement(o.k,{h:"60px",width:"100%",justifyContent:"center",alignItems:"center",px:4,position:"relative"},c&&l.createElement(r.xu,{left:4,fontSize:"1.5rem",position:"absolute",top:"50%",onClick:m.goBack,transform:"translateY(-50%)"},l.createElement(a.CF5,null)),t,n&&l.createElement(r.xu,{right:4,top:"50%",transform:"translateY(-50%)",position:"absolute",fontSize:"1.5rem",onClick:f},n)))}))},5975:function(e,t,n){"use strict";n.d(t,{T:function(){return a}});var r=n(4096),o=n(7294),l=function(){return(l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},a=o.memo((function(e){var t=e.children,n=e.header,a=e.footer,u=i(e,["children","header","footer"]);return o.createElement(r.k,{flexDirection:"column",flex:1,height:"100%",maxHeight:"100%",overflow:"hidden"},n,o.createElement(r.k,l({},u,{flex:1,flexDirection:"column",overflowX:"hidden",overflowY:"scroll"}),t),a)}))},8928:function(e,t,n){"use strict";n.d(t,{L:function(){return i}});var r=n(336),o=n(7294),l=n(8725),i=o.memo((function(e){var t=e.title;return o.createElement(l.h,{canGoBack:!0},o.createElement(r.X,{fontSize:"lg"},t))}))},2769:function(e,t,n){"use strict";n.d(t,{g:function(){return r}});var r={name:"Vintage Leather",theme:"yellow.400"}},406:function(e,t,n){"use strict";n.r(t),n.d(t,{MainComponent:function(){return U},SettingMenuState:function(){return B},useSettingMenuAction:function(){return J}});var r=n(2804),o=n(6237),l=n(7294),i=n(5975),a=n(8928),u=n(5555),c=n(980),f=n(5408),m=n(2769),d=l.memo((function(){var e=J().openModal,t=(0,c.useColorModeValue)("white","gray.800");return l.createElement(u.$,{h:"60px"},l.createElement(f.z,{onClick:function(){return e()},isFullWidth:!0,backgroundColor:m.g.theme,color:t,fontWeight:"500"},"新增產品"))})),s=n(4096),p=n(336),g=n(8125),h=n(7101),v=function(e){return e(r.default.useRecoilValue(B))},y=n(9583),O=l.memo((function(){var e=v((function(e){return e.menu})),t=J(),n=t.openModal,r=t.deleteProduct;return(null==e?void 0:e.length)?l.createElement(s.k,{flexDirection:"column",borderTopWidth:"1px",borderBottomWidth:"1px",backgroundColor:"gray.700"},e&&e.map((function(e){return l.createElement(s.k,{key:e.id,justifyContent:"space-between",alignItems:"center",py:3,px:4,css:{"&:not(:last-of-type)":{borderBottomWidth:"1px"}}},l.createElement(s.k,{alignItems:"center"},l.createElement(p.X,{fontSize:"lg",fontWeight:500},e.name),l.createElement(g.C,{ml:2,rounded:"md",variant:"solid",colorScheme:"green",fontSize:"lg",mr:2},"$",e.price)),l.createElement(h.h,null,l.createElement(f.z,{onClick:function(){return n(e)},colorScheme:"yellow",size:"sm",fontSize:"md",h:7},l.createElement(y.tU3,null)),l.createElement(f.z,{onClick:function(){return r(e.id)},colorScheme:"red",size:"sm",fontSize:"md",h:7},l.createElement(y.Xm5,null))))}))):l.createElement(s.k,{flex:1,flexDir:"column",justifyContent:"center",alignItems:"center"},l.createElement("span",null,"暫時未有產品"))})),E=n(8135),b=n(7602),S=l.memo((function(e){var t=e.isOpen,n=e.children,r=e.onClose,o=e.title;return l.createElement(E.dy,{isOpen:t,onClose:r,placement:"bottom"},l.createElement(b.ZA,null),l.createElement(E.sc,{borderRadius:"10px 10px 0 0"},l.createElement(b.xB,null,o),l.createElement(b.ol,null),l.createElement(b.fe,null,n)))})),C=n(51),x=n(4848),w=n(6618),k=n(70),I=function(){return(I=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},j=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},R=l.memo((function(e){var t=e.value,n=e.onChange,r=j(e,["value","onChange"]),o=(0,c.useColorModeValue)("white","gray.700");return l.createElement(k.I,I({},r,{backgroundColor:o,value:t||"",onChange:function(e){var t=e.target.value;n(t.trim()?t:null)}}))})),D=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,l=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=l.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=l.return)&&n.call(l)}finally{if(o)throw o.error}}return i},M=l.memo((function(e){var t=e.value,n=e.onChange,r=D(l.useState(t?""+t:null),2),o=r[0],i=r[1];return l.createElement(R,{value:o,onChange:i,onBlur:function(){if(null!==o){var e=parseInt(o,10);Number.isNaN(e)||e<0?i(t?""+t:null):(n(e),i(String(e)))}else n(null)}})})),z=l.memo((function(){var e=v((function(e){return e.openedItem})),t=J(),n=t.closeModal,r=t.updateOpenedItem,o=t.createOrUpdateProduct,i=("new"===(null==e?void 0:e.id)?"新增":"修改")+"產品",a=(0,c.useToast)(),u=(0,c.useColorModeValue)("white","gray.800");return l.createElement(S,{title:i,isOpen:null!==e,onClose:n},e&&l.createElement(C.gC,{spacing:8,pb:4},l.createElement(x.NI,null,l.createElement(w.l,null,"產品名稱"),l.createElement(R,{value:e.editingData.name,onChange:function(e){return r({name:e})}})),l.createElement(x.NI,null,l.createElement(w.l,null,"價錢"),l.createElement(M,{value:e.editingData.price,onChange:function(e){return r({price:e})}})),l.createElement(s.k,{w:"100%",flexDirection:"column"},l.createElement(f.z,{onClick:function(){(null==e?void 0:e.editingData.name)&&null!==!(null==e?void 0:e.editingData.price)?o():a({title:"錯誤",description:"資料不全",position:"top",status:"error",duration:3e3})},isFullWidth:!0,backgroundColor:m.g.theme,color:u,fontWeight:"normal",fontSize:"lg",mb:2},"new"===e.id?"新增":"修改"),l.createElement(f.z,{onClick:n,isFullWidth:!0,color:u,backgroundColor:"red.400",fontWeight:"normal",fontSize:"lg"},"關閉"))))})),P=l.memo((function(){return l.createElement(i.T,{header:l.createElement(a.L,{title:"產品目錄"}),footer:l.createElement(d,null),pt:4},l.createElement(O,null),l.createElement(z,null))})),Y=n(7),N=n(4354),K=n(4586),W=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},F=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,l=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=l.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=l.return)&&n.call(l)}finally{if(o)throw o.error}}return i},_=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},B=r.default.atom({key:"SettingMenuState",default:{menu:null,openedItem:null}}),J=function(){var e=(0,o.useCoilState)(B),t=e.getState,n=e.setState,r=function(){n((function(e){return e.openedItem=null}))};return{onRouteMatched:function(e,t){var r;r=Y.O.getMenu(),n((function(e){return e.menu=r}))},openModal:function(e){if(e){var t=e.id,r=W(e,["id"]);n((function(e){return e.openedItem={id:t,editingData:r}}))}else n((function(e){return e.openedItem={id:"new",editingData:{name:null,price:null}}}))},closeModal:r,updateOpenedItem:function(e){n((function(t){var n;return N.ObjectUtil.safeAssign(null===(n=t.openedItem)||void 0===n?void 0:n.editingData,e)}))},createOrUpdateProduct:function(){var e=t().openedItem,o=_([],F(t().menu));if(e){var l=e.id,i=e.editingData;if("new"===l){var a={id:(0,K.Z)(),name:i.name,price:i.price};o.push(a)}else{var u=o.findIndex((function(e){return e.id===l}));if(-1!==u){a={id:l,name:i.name,price:i.price};o[u]=a}}Y.O.updateMenu(o),n((function(e){return e.menu=o})),r()}},deleteProduct:function(e){var r=_([],F(t().menu)),o=r.findIndex((function(t){return t.id===e}));-1!==o&&(r.splice(o,1),Y.O.updateMenu(r),n((function(e){return e.menu=r})))}}},U=(0,o.injectLifeCycle)(P,J)},7:function(e,t,n){"use strict";n.d(t,{O:function(){return o}});var r=n(3030),o=function(){function e(){}return e.getMenu=function(){var t=localStorage.getItem(e.KEY);if(!t){var n=[];return localStorage.setItem(e.KEY,JSON.stringify(n)),n}return JSON.parse(t)},e.updateMenu=function(t){localStorage.setItem(e.KEY,JSON.stringify(t)),r.O.refreshRecord()},e.KEY="@@SalesRecord/menu",e}()},3030:function(e,t,n){"use strict";n.d(t,{O:function(){return i}});var r=n(7),o=n(4354),l=function(){return(l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=function(){function e(){}return e.getRecord=function(){var t=localStorage.getItem(e.RECORD_KEY);return t?JSON.parse(t):(localStorage.setItem(e.RECORD_KEY,JSON.stringify({})),{})},e.getDateRecord=function(t){var n=this.dateFormatter(t),i=this.getRecord(),a=r.O.getMenu(),u=o.ArrayUtil.toObject(a,(function(e){return[e.id,l(l({},e),{quantity:0})]})),c=i[n];return c||(i[n]=u,localStorage.setItem(e.RECORD_KEY,JSON.stringify(i)),u)},e.refreshRecord=function(){var e=this.getDateRecord(),t=r.O.getMenu(),n=o.ArrayUtil.toObject(t,(function(t){var n=e[t.id];return void 0===n?[t.id,l(l({},t),{quantity:0})]:[t.id,n]}));this.updateDateRecord(n)},e.updateDateRecord=function(t,n){void 0===n&&(n=new Date);var r=this.dateFormatter(n),o=this.getRecord();o[r]=t,localStorage.setItem(e.RECORD_KEY,JSON.stringify(o))},e.dateFormatter=function(e){return void 0===e&&(e=new Date),e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},e.RECORD_KEY="@@SalesRecord/record",e.HISTORY_KEY="@@SalesRecord/history",e}()}}]);